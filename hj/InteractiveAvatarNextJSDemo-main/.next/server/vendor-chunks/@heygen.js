"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/@heygen";
exports.ids = ["vendor-chunks/@heygen"];
exports.modules = {

/***/ "(ssr)/./node_modules/@heygen/streaming-avatar/lib/index.esm.js":
/*!****************************************************************!*\
  !*** ./node_modules/@heygen/streaming-avatar/lib/index.esm.js ***!
  \****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AvatarQuality: () => (/* binding */ AvatarQuality),\n/* harmony export */   StreamingEvents: () => (/* binding */ StreamingEvents),\n/* harmony export */   TaskMode: () => (/* binding */ TaskMode),\n/* harmony export */   TaskType: () => (/* binding */ TaskType),\n/* harmony export */   VoiceEmotion: () => (/* binding */ VoiceEmotion),\n/* harmony export */   \"default\": () => (/* binding */ StreamingAvatar)\n/* harmony export */ });\n/* harmony import */ var livekit_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! livekit-client */ \"(ssr)/./node_modules/livekit-client/dist/livekit-client.esm.mjs\");\n/* harmony import */ var protobufjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! protobufjs */ \"(ssr)/./node_modules/protobufjs/index.js\");\n\n\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\ntypeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\n\nfunction sleep(ms) {\n    return new Promise(function (resolve) { return setTimeout(resolve, ms); });\n}\nfunction convertFloat32ToS16PCM(float32Array) {\n    var int16Array = new Int16Array(float32Array.length);\n    for (var i = 0; i < float32Array.length; i++) {\n        var clampedValue = Math.max(-1, Math.min(1, float32Array[i]));\n        int16Array[i] = clampedValue < 0 ? clampedValue * 32768 : clampedValue * 32767;\n    }\n    return int16Array;\n}\n\nvar options = {\n\tsyntax: \"proto3\"\n};\nvar nested = {\n\tpipecat: {\n\t\tnested: {\n\t\t\tTextFrame: {\n\t\t\t\tfields: {\n\t\t\t\t\tid: {\n\t\t\t\t\t\ttype: \"uint64\",\n\t\t\t\t\t\tid: 1\n\t\t\t\t\t},\n\t\t\t\t\tname: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tid: 2\n\t\t\t\t\t},\n\t\t\t\t\ttext: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tid: 3\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tAudioRawFrame: {\n\t\t\t\tfields: {\n\t\t\t\t\tid: {\n\t\t\t\t\t\ttype: \"uint64\",\n\t\t\t\t\t\tid: 1\n\t\t\t\t\t},\n\t\t\t\t\tname: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tid: 2\n\t\t\t\t\t},\n\t\t\t\t\taudio: {\n\t\t\t\t\t\ttype: \"bytes\",\n\t\t\t\t\t\tid: 3\n\t\t\t\t\t},\n\t\t\t\t\tsampleRate: {\n\t\t\t\t\t\ttype: \"uint32\",\n\t\t\t\t\t\tid: 4\n\t\t\t\t\t},\n\t\t\t\t\tnumChannels: {\n\t\t\t\t\t\ttype: \"uint32\",\n\t\t\t\t\t\tid: 5\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tTranscriptionFrame: {\n\t\t\t\tfields: {\n\t\t\t\t\tid: {\n\t\t\t\t\t\ttype: \"uint64\",\n\t\t\t\t\t\tid: 1\n\t\t\t\t\t},\n\t\t\t\t\tname: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tid: 2\n\t\t\t\t\t},\n\t\t\t\t\ttext: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tid: 3\n\t\t\t\t\t},\n\t\t\t\t\tuserId: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tid: 4\n\t\t\t\t\t},\n\t\t\t\t\ttimestamp: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tid: 5\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tFrame: {\n\t\t\t\toneofs: {\n\t\t\t\t\tframe: {\n\t\t\t\t\t\toneof: [\n\t\t\t\t\t\t\t\"text\",\n\t\t\t\t\t\t\t\"audio\",\n\t\t\t\t\t\t\t\"transcription\"\n\t\t\t\t\t\t]\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfields: {\n\t\t\t\t\ttext: {\n\t\t\t\t\t\ttype: \"TextFrame\",\n\t\t\t\t\t\tid: 1\n\t\t\t\t\t},\n\t\t\t\t\taudio: {\n\t\t\t\t\t\ttype: \"AudioRawFrame\",\n\t\t\t\t\t\tid: 2\n\t\t\t\t\t},\n\t\t\t\t\ttranscription: {\n\t\t\t\t\t\ttype: \"TranscriptionFrame\",\n\t\t\t\t\t\tid: 3\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\nvar jsonDescriptor = {\n\toptions: options,\n\tnested: nested\n};\n\nvar AvatarQuality;\n(function (AvatarQuality) {\n    AvatarQuality[\"Low\"] = \"low\";\n    AvatarQuality[\"Medium\"] = \"medium\";\n    AvatarQuality[\"High\"] = \"high\";\n})(AvatarQuality || (AvatarQuality = {}));\nvar VoiceEmotion;\n(function (VoiceEmotion) {\n    VoiceEmotion[\"EXCITED\"] = \"excited\";\n    VoiceEmotion[\"SERIOUS\"] = \"serious\";\n    VoiceEmotion[\"FRIENDLY\"] = \"friendly\";\n    VoiceEmotion[\"SOOTHING\"] = \"soothing\";\n    VoiceEmotion[\"BROADCASTER\"] = \"broadcaster\";\n})(VoiceEmotion || (VoiceEmotion = {}));\nvar TaskType;\n(function (TaskType) {\n    TaskType[\"TALK\"] = \"talk\";\n    TaskType[\"REPEAT\"] = \"repeat\";\n})(TaskType || (TaskType = {}));\nvar TaskMode;\n(function (TaskMode) {\n    TaskMode[\"SYNC\"] = \"sync\";\n    TaskMode[\"ASYNC\"] = \"async\";\n})(TaskMode || (TaskMode = {}));\n// event types --------------------------------\nvar StreamingEvents;\n(function (StreamingEvents) {\n    StreamingEvents[\"AVATAR_START_TALKING\"] = \"avatar_start_talking\";\n    StreamingEvents[\"AVATAR_STOP_TALKING\"] = \"avatar_stop_talking\";\n    StreamingEvents[\"AVATAR_TALKING_MESSAGE\"] = \"avatar_talking_message\";\n    StreamingEvents[\"AVATAR_END_MESSAGE\"] = \"avatar_end_message\";\n    StreamingEvents[\"USER_TALKING_MESSAGE\"] = \"user_talking_message\";\n    StreamingEvents[\"USER_END_MESSAGE\"] = \"user_end_message\";\n    StreamingEvents[\"USER_START\"] = \"user_start\";\n    StreamingEvents[\"USER_STOP\"] = \"user_stop\";\n    StreamingEvents[\"USER_SILENCE\"] = \"user_silence\";\n    StreamingEvents[\"STREAM_READY\"] = \"stream_ready\";\n    StreamingEvents[\"STREAM_DISCONNECTED\"] = \"stream_disconnected\";\n})(StreamingEvents || (StreamingEvents = {}));\nvar APIError = /** @class */ (function (_super) {\n    __extends(APIError, _super);\n    function APIError(message, status, responseText) {\n        var _this = _super.call(this, message) || this;\n        _this.name = 'APIError';\n        _this.status = status;\n        _this.responseText = responseText;\n        return _this;\n    }\n    return APIError;\n}(Error));\nvar StreamingAvatar = /** @class */ (function () {\n    function StreamingAvatar(_a) {\n        var token = _a.token, _b = _a.basePath, basePath = _b === void 0 ? \"https://api.heygen.com\" : _b;\n        this.room = null;\n        this.mediaStream = null;\n        this.eventTarget = new EventTarget();\n        this.audioContext = null;\n        this.webSocket = null;\n        this.scriptProcessor = null;\n        this.mediaStreamAudioSource = null;\n        this.mediaDevicesStream = null;\n        this.sessionId = null;\n        this.token = token;\n        this.basePath = basePath;\n    }\n    StreamingAvatar.prototype.createStartAvatar = function (requestData) {\n        return __awaiter(this, void 0, void 0, function () {\n            var sessionInfo, room, mediaStream;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.newSession(requestData)];\n                    case 1:\n                        sessionInfo = _a.sent();\n                        this.sessionId = sessionInfo.session_id;\n                        this.language = requestData.language;\n                        room = new livekit_client__WEBPACK_IMPORTED_MODULE_0__.Room({\n                            adaptiveStream: true,\n                            dynacast: true,\n                            videoCaptureDefaults: {\n                                resolution: livekit_client__WEBPACK_IMPORTED_MODULE_0__.VideoPresets.h720.resolution,\n                            },\n                        });\n                        this.room = room;\n                        this.mediaStream = null;\n                        room.on(livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.DataReceived, function (roomMessage) {\n                            var eventMsg = null;\n                            try {\n                                var messageString = new TextDecoder().decode(roomMessage);\n                                eventMsg = JSON.parse(messageString);\n                            }\n                            catch (e) {\n                                console.error(e);\n                            }\n                            if (!eventMsg) {\n                                return;\n                            }\n                            _this.emit(eventMsg.type, eventMsg);\n                        });\n                        mediaStream = new MediaStream();\n                        room.on(livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackSubscribed, function (track) {\n                            if (track.kind === \"video\" || track.kind === \"audio\") {\n                                mediaStream.addTrack(track.mediaStreamTrack);\n                                var hasVideoTrack = mediaStream.getVideoTracks().length > 0;\n                                var hasAudioTrack = mediaStream.getAudioTracks().length > 0;\n                                if (hasVideoTrack &&\n                                    hasAudioTrack &&\n                                    !_this.mediaStream) {\n                                    _this.mediaStream = mediaStream;\n                                    _this.emit(StreamingEvents.STREAM_READY, _this.mediaStream);\n                                }\n                            }\n                        });\n                        room.on(livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.TrackUnsubscribed, function (track) {\n                            var mediaTrack = track.mediaStreamTrack;\n                            if (mediaTrack) {\n                                mediaStream.removeTrack(mediaTrack);\n                            }\n                        });\n                        room.on(livekit_client__WEBPACK_IMPORTED_MODULE_0__.RoomEvent.Disconnected, function (reason) {\n                            _this.emit(StreamingEvents.STREAM_DISCONNECTED, reason);\n                        });\n                        _a.label = 2;\n                    case 2:\n                        _a.trys.push([2, 4, , 5]);\n                        return [4 /*yield*/, room.prepareConnection(sessionInfo.url, sessionInfo.access_token)];\n                    case 3:\n                        _a.sent();\n                        return [3 /*break*/, 5];\n                    case 4:\n                        _a.sent();\n                        return [3 /*break*/, 5];\n                    case 5: return [4 /*yield*/, this.startSession()];\n                    case 6:\n                        _a.sent();\n                        return [4 /*yield*/, room.connect(sessionInfo.url, sessionInfo.access_token)];\n                    case 7:\n                        _a.sent();\n                        return [2 /*return*/, sessionInfo];\n                }\n            });\n        });\n    };\n    StreamingAvatar.prototype.startVoiceChat = function () {\n        return __awaiter(this, arguments, void 0, function (requestData) {\n            var devicesStream, e_1;\n            var _this = this;\n            var _a, _b, _c;\n            if (requestData === void 0) { requestData = {}; }\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0:\n                        requestData.useSilencePrompt = requestData.useSilencePrompt || false;\n                        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n                            return [2 /*return*/];\n                        }\n                        _d.label = 1;\n                    case 1:\n                        _d.trys.push([1, 6, , 7]);\n                        return [4 /*yield*/, this.loadAudioRawFrame()];\n                    case 2:\n                        _d.sent();\n                        return [4 /*yield*/, this.connectWebSocket({ useSilencePrompt: requestData.useSilencePrompt })];\n                    case 3:\n                        _d.sent();\n                        this.audioContext = new window.AudioContext({\n                            latencyHint: 'interactive',\n                            sampleRate: 16000,\n                        });\n                        return [4 /*yield*/, navigator.mediaDevices.getUserMedia({\n                                audio: {\n                                    sampleRate: 16000,\n                                    channelCount: 1,\n                                    autoGainControl: true,\n                                    echoCancellation: true,\n                                    noiseSuppression: true,\n                                },\n                            })];\n                    case 4:\n                        devicesStream = _d.sent();\n                        this.mediaDevicesStream = devicesStream;\n                        this.mediaStreamAudioSource = (_a = this.audioContext) === null || _a === void 0 ? void 0 : _a.createMediaStreamSource(devicesStream);\n                        this.scriptProcessor = (_b = this.audioContext) === null || _b === void 0 ? void 0 : _b.createScriptProcessor(512, 1, 1);\n                        this.mediaStreamAudioSource.connect(this.scriptProcessor);\n                        this.scriptProcessor.connect((_c = this.audioContext) === null || _c === void 0 ? void 0 : _c.destination);\n                        this.scriptProcessor.onaudioprocess = function (event) {\n                            var _a, _b, _c;\n                            if (!_this.webSocket) {\n                                return;\n                            }\n                            var audioData = event.inputBuffer.getChannelData(0);\n                            var pcmS16Array = convertFloat32ToS16PCM(audioData);\n                            var pcmByteArray = new Uint8Array(pcmS16Array.buffer);\n                            var frame = (_a = _this.audioRawFrame) === null || _a === void 0 ? void 0 : _a.create({\n                                audio: {\n                                    audio: Array.from(pcmByteArray),\n                                    sampleRate: 16000,\n                                    numChannels: 1,\n                                },\n                            });\n                            var encodedFrame = new Uint8Array((_b = _this.audioRawFrame) === null || _b === void 0 ? void 0 : _b.encode(frame).finish());\n                            (_c = _this.webSocket) === null || _c === void 0 ? void 0 : _c.send(encodedFrame);\n                        };\n                        // though room has been connected, but the stream may not be ready.\n                        return [4 /*yield*/, sleep(2000)];\n                    case 5:\n                        // though room has been connected, but the stream may not be ready.\n                        _d.sent();\n                        return [3 /*break*/, 7];\n                    case 6:\n                        e_1 = _d.sent();\n                        console.error(e_1);\n                        throw e_1;\n                    case 7: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    StreamingAvatar.prototype.closeVoiceChat = function () {\n        var _a, _b;\n        try {\n            if (this.audioContext) {\n                this.audioContext = null;\n            }\n            if (this.scriptProcessor) {\n                this.scriptProcessor.disconnect();\n                this.scriptProcessor = null;\n            }\n            if (this.mediaStreamAudioSource) {\n                this.mediaStreamAudioSource.disconnect();\n                this.mediaStreamAudioSource = null;\n            }\n            if (this.mediaDevicesStream) {\n                (_b = (_a = this.mediaDevicesStream) === null || _a === void 0 ? void 0 : _a.getTracks()) === null || _b === void 0 ? void 0 : _b.forEach(function (track) { return track.stop(); });\n                this.mediaDevicesStream = null;\n            }\n            if (this.webSocket) {\n                this.webSocket.close();\n            }\n        }\n        catch (e) { }\n    };\n    StreamingAvatar.prototype.newSession = function (requestData) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, _b, _c, _d;\n            return __generator(this, function (_e) {\n                return [2 /*return*/, this.request(\"/v1/streaming.new\", {\n                        avatar_name: requestData.avatarName,\n                        quality: requestData.quality,\n                        knowledge_base_id: requestData.knowledgeId,\n                        knowledge_base: requestData.knowledgeBase,\n                        voice: {\n                            voice_id: (_a = requestData.voice) === null || _a === void 0 ? void 0 : _a.voiceId,\n                            rate: (_b = requestData.voice) === null || _b === void 0 ? void 0 : _b.rate,\n                            emotion: (_c = requestData.voice) === null || _c === void 0 ? void 0 : _c.emotion,\n                            elevenlabs_settings: (_d = requestData === null || requestData === void 0 ? void 0 : requestData.voice) === null || _d === void 0 ? void 0 : _d.elevenlabsSettings,\n                        },\n                        language: requestData.language,\n                        version: \"v2\",\n                        video_encoding: \"H264\",\n                        source: 'sdk',\n                        disable_idle_timeout: requestData.disableIdleTimeout,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.startSession = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.request(\"/v1/streaming.start\", {\n                        session_id: this.sessionId,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.speak = function (requestData) {\n        return __awaiter(this, void 0, void 0, function () {\n            var frame, encodedFrame;\n            var _a, _b, _c;\n            return __generator(this, function (_d) {\n                requestData.taskType = requestData.taskType || requestData.task_type || TaskType.TALK;\n                requestData.taskMode = requestData.taskMode || TaskMode.ASYNC;\n                // try to use websocket first\n                // only support talk task\n                if (this.webSocket && this.audioRawFrame && requestData.task_type === TaskType.TALK && requestData.taskMode !== TaskMode.SYNC) {\n                    frame = (_a = this.audioRawFrame) === null || _a === void 0 ? void 0 : _a.create({\n                        text: {\n                            text: requestData.text,\n                        },\n                    });\n                    encodedFrame = new Uint8Array((_b = this.audioRawFrame) === null || _b === void 0 ? void 0 : _b.encode(frame).finish());\n                    (_c = this.webSocket) === null || _c === void 0 ? void 0 : _c.send(encodedFrame);\n                    return [2 /*return*/];\n                }\n                return [2 /*return*/, this.request(\"/v1/streaming.task\", {\n                        text: requestData.text,\n                        session_id: this.sessionId,\n                        task_mode: requestData.taskMode,\n                        task_type: requestData.taskType,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.startListening = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.request(\"/v1/streaming.start_listening\", {\n                        session_id: this.sessionId,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.stopListening = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.request(\"/v1/streaming.stop_listening\", {\n                        session_id: this.sessionId,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.interrupt = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.request(\"/v1/streaming.interrupt\", {\n                        session_id: this.sessionId,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.stopAvatar = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                // clear some resources\n                this.closeVoiceChat();\n                return [2 /*return*/, this.request(\"/v1/streaming.stop\", {\n                        session_id: this.sessionId,\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.on = function (eventType, listener) {\n        this.eventTarget.addEventListener(eventType, listener);\n        return this;\n    };\n    StreamingAvatar.prototype.off = function (eventType, listener) {\n        this.eventTarget.removeEventListener(eventType, listener);\n        return this;\n    };\n    StreamingAvatar.prototype.request = function (path, params, config) {\n        return __awaiter(this, void 0, void 0, function () {\n            var response, errorText, jsonData, error_2;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 5, , 6]);\n                        return [4 /*yield*/, fetch(this.getRequestUrl(path), {\n                                method: \"POST\",\n                                headers: {\n                                    Authorization: \"Bearer \".concat(this.token),\n                                    \"Content-Type\": \"application/json\",\n                                },\n                                body: JSON.stringify(params),\n                            })];\n                    case 1:\n                        response = _a.sent();\n                        if (!!response.ok) return [3 /*break*/, 3];\n                        return [4 /*yield*/, response.text()];\n                    case 2:\n                        errorText = _a.sent();\n                        throw new APIError(\"API request failed with status \".concat(response.status), response.status, errorText);\n                    case 3: return [4 /*yield*/, response.json()];\n                    case 4:\n                        jsonData = _a.sent();\n                        return [2 /*return*/, jsonData.data];\n                    case 5:\n                        error_2 = _a.sent();\n                        throw error_2;\n                    case 6: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    StreamingAvatar.prototype.emit = function (eventType, detail) {\n        var event = new CustomEvent(eventType, { detail: detail });\n        this.eventTarget.dispatchEvent(event);\n    };\n    StreamingAvatar.prototype.getRequestUrl = function (endpoint) {\n        return \"\".concat(this.basePath).concat(endpoint);\n    };\n    StreamingAvatar.prototype.connectWebSocket = function (requestData) {\n        return __awaiter(this, void 0, void 0, function () {\n            var websocketUrl;\n            var _this = this;\n            return __generator(this, function (_a) {\n                websocketUrl = \"wss://\".concat(new URL(this.basePath).hostname, \"/v1/ws/streaming.chat?session_id=\").concat(this.sessionId, \"&session_token=\").concat(this.token, \"&silence_response=\").concat(requestData.useSilencePrompt);\n                if (this.language) {\n                    websocketUrl += \"&stt_language=\".concat(this.language);\n                }\n                this.webSocket = new WebSocket(websocketUrl);\n                this.webSocket.addEventListener('message', function (event) {\n                    var eventData = null;\n                    try {\n                        eventData = JSON.parse(event.data);\n                    }\n                    catch (e) {\n                        console.error(e);\n                        return;\n                    }\n                    _this.emit(eventData.event_type, eventData);\n                });\n                this.webSocket.addEventListener('close', function (event) {\n                    _this.webSocket = null;\n                });\n                return [2 /*return*/, new Promise(function (resolve, reject) {\n                        var _a, _b;\n                        (_a = _this.webSocket) === null || _a === void 0 ? void 0 : _a.addEventListener('error', function (event) {\n                            _this.webSocket = null;\n                            reject(event);\n                        });\n                        (_b = _this.webSocket) === null || _b === void 0 ? void 0 : _b.addEventListener('open', function () {\n                            resolve(true);\n                        });\n                    })];\n            });\n        });\n    };\n    StreamingAvatar.prototype.loadAudioRawFrame = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var root;\n            return __generator(this, function (_a) {\n                if (!this.audioRawFrame) {\n                    root = protobufjs__WEBPACK_IMPORTED_MODULE_1__.Root.fromJSON(jsonDescriptor);\n                    this.audioRawFrame = root === null || root === void 0 ? void 0 : root.lookupType('pipecat.Frame');\n                }\n                return [2 /*return*/];\n            });\n        });\n    };\n    return StreamingAvatar;\n}());\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGhleWdlbi9zdHJlYW1pbmctYXZhdGFyL2xpYi9pbmRleC5lc20uanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBK0Q7QUFDN0I7O0FBRWxDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsZ0JBQWdCLHNDQUFzQyxrQkFBa0I7QUFDbkYsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLCtEQUErRCxpQkFBaUI7QUFDNUc7QUFDQSxvQ0FBb0MsTUFBTSwrQkFBK0IsWUFBWTtBQUNyRixtQ0FBbUMsTUFBTSxtQ0FBbUMsWUFBWTtBQUN4RixnQ0FBZ0M7QUFDaEM7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsY0FBYyw2QkFBNkIsMEJBQTBCLGNBQWMscUJBQXFCO0FBQ3hHLGlCQUFpQixvREFBb0QscUVBQXFFLGNBQWM7QUFDeEosdUJBQXVCLHNCQUFzQjtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0M7QUFDeEMsbUNBQW1DLFNBQVM7QUFDNUMsbUNBQW1DLFdBQVcsVUFBVTtBQUN4RCwwQ0FBMEMsY0FBYztBQUN4RDtBQUNBLDhHQUE4RyxPQUFPO0FBQ3JILGlGQUFpRixpQkFBaUI7QUFDbEcseURBQXlELGdCQUFnQixRQUFRO0FBQ2pGLCtDQUErQyxnQkFBZ0IsZ0JBQWdCO0FBQy9FO0FBQ0Esa0NBQWtDO0FBQ2xDO0FBQ0E7QUFDQSxVQUFVLFlBQVksYUFBYSxTQUFTLFVBQVU7QUFDdEQsb0NBQW9DLFNBQVM7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSw0Q0FBNEMsaUNBQWlDO0FBQzdFO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQix5QkFBeUI7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyxzQ0FBc0M7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLG9DQUFvQztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsNEJBQTRCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyw0QkFBNEI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsMENBQTBDO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsZ0RBQUk7QUFDdkM7QUFDQTtBQUNBO0FBQ0EsNENBQTRDLHdEQUFZO0FBQ3hELDZCQUE2QjtBQUM3Qix5QkFBeUI7QUFDekI7QUFDQTtBQUNBLGdDQUFnQyxxREFBUztBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQSxnQ0FBZ0MscURBQVM7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QixnQ0FBZ0MscURBQVM7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekIsZ0NBQWdDLHFEQUFTO0FBQ3pDO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUVBQXFFLGdEQUFnRDtBQUNySDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDO0FBQ2pDLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNktBQTZLLHNCQUFzQjtBQUNuTTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QixxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQixhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBLGlEQUFpRCxnQkFBZ0I7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekIscUJBQXFCO0FBQ3JCLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLDRDQUFhO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBLENBQUM7O0FBRXVHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbmV4dC1hcHAtdGVtcGxhdGUvLi9ub2RlX21vZHVsZXMvQGhleWdlbi9zdHJlYW1pbmctYXZhdGFyL2xpYi9pbmRleC5lc20uanM/YThlMyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSb29tLCBWaWRlb1ByZXNldHMsIFJvb21FdmVudCB9IGZyb20gJ2xpdmVraXQtY2xpZW50JztcbmltcG9ydCBwcm90b2J1ZiBmcm9tICdwcm90b2J1ZmpzJztcblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5Db3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi5cclxuXHJcblBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZC9vciBkaXN0cmlidXRlIHRoaXMgc29mdHdhcmUgZm9yIGFueVxyXG5wdXJwb3NlIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQuXHJcblxyXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiIEFORCBUSEUgQVVUSE9SIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRIXHJcblJFR0FSRCBUTyBUSElTIFNPRlRXQVJFIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWVxyXG5BTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsXHJcbklORElSRUNULCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTVxyXG5MT1NTIE9GIFVTRSwgREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUlxyXG5PVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SXHJcblBFUkZPUk1BTkNFIE9GIFRISVMgU09GVFdBUkUuXHJcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovXHJcbi8qIGdsb2JhbCBSZWZsZWN0LCBQcm9taXNlLCBTdXBwcmVzc2VkRXJyb3IsIFN5bWJvbCAqL1xyXG5cclxudmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbihkLCBiKSB7XHJcbiAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxyXG4gICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxufTtcclxuXHJcbmZ1bmN0aW9uIF9fZXh0ZW5kcyhkLCBiKSB7XHJcbiAgICBpZiAodHlwZW9mIGIgIT09IFwiZnVuY3Rpb25cIiAmJiBiICE9PSBudWxsKVxyXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDbGFzcyBleHRlbmRzIHZhbHVlIFwiICsgU3RyaW5nKGIpICsgXCIgaXMgbm90IGEgY29uc3RydWN0b3Igb3IgbnVsbFwiKTtcclxuICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cclxuICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxufVxyXG5cclxuZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gX19nZW5lcmF0b3IodGhpc0FyZywgYm9keSkge1xyXG4gICAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOyByZXR1cm4gdFsxXTsgfSwgdHJ5czogW10sIG9wczogW10gfSwgZiwgeSwgdCwgZztcclxuICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCBcInRocm93XCI6IHZlcmIoMSksIFwicmV0dXJuXCI6IHZlcmIoMikgfSwgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XHJcbiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7XHJcbiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuXCIpO1xyXG4gICAgICAgIHdoaWxlIChnICYmIChnID0gMCwgb3BbMF0gJiYgKF8gPSAwKSksIF8pIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbXCJyZXR1cm5cIl0gOiBvcFswXSA/IHlbXCJ0aHJvd1wiXSB8fCAoKHQgPSB5W1wicmV0dXJuXCJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDtcclxuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTtcclxuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cclxuICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTtcclxuICAgIH1cclxufVxyXG5cclxudHlwZW9mIFN1cHByZXNzZWRFcnJvciA9PT0gXCJmdW5jdGlvblwiID8gU3VwcHJlc3NlZEVycm9yIDogZnVuY3Rpb24gKGVycm9yLCBzdXBwcmVzc2VkLCBtZXNzYWdlKSB7XHJcbiAgICB2YXIgZSA9IG5ldyBFcnJvcihtZXNzYWdlKTtcclxuICAgIHJldHVybiBlLm5hbWUgPSBcIlN1cHByZXNzZWRFcnJvclwiLCBlLmVycm9yID0gZXJyb3IsIGUuc3VwcHJlc3NlZCA9IHN1cHByZXNzZWQsIGU7XHJcbn07XG5cbmZ1bmN0aW9uIHNsZWVwKG1zKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJldHVybiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKTsgfSk7XG59XG5mdW5jdGlvbiBjb252ZXJ0RmxvYXQzMlRvUzE2UENNKGZsb2F0MzJBcnJheSkge1xuICAgIHZhciBpbnQxNkFycmF5ID0gbmV3IEludDE2QXJyYXkoZmxvYXQzMkFycmF5Lmxlbmd0aCk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmbG9hdDMyQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGNsYW1wZWRWYWx1ZSA9IE1hdGgubWF4KC0xLCBNYXRoLm1pbigxLCBmbG9hdDMyQXJyYXlbaV0pKTtcbiAgICAgICAgaW50MTZBcnJheVtpXSA9IGNsYW1wZWRWYWx1ZSA8IDAgPyBjbGFtcGVkVmFsdWUgKiAzMjc2OCA6IGNsYW1wZWRWYWx1ZSAqIDMyNzY3O1xuICAgIH1cbiAgICByZXR1cm4gaW50MTZBcnJheTtcbn1cblxudmFyIG9wdGlvbnMgPSB7XG5cdHN5bnRheDogXCJwcm90bzNcIlxufTtcbnZhciBuZXN0ZWQgPSB7XG5cdHBpcGVjYXQ6IHtcblx0XHRuZXN0ZWQ6IHtcblx0XHRcdFRleHRGcmFtZToge1xuXHRcdFx0XHRmaWVsZHM6IHtcblx0XHRcdFx0XHRpZDoge1xuXHRcdFx0XHRcdFx0dHlwZTogXCJ1aW50NjRcIixcblx0XHRcdFx0XHRcdGlkOiAxXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRuYW1lOiB7XG5cdFx0XHRcdFx0XHR0eXBlOiBcInN0cmluZ1wiLFxuXHRcdFx0XHRcdFx0aWQ6IDJcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdHRleHQ6IHtcblx0XHRcdFx0XHRcdHR5cGU6IFwic3RyaW5nXCIsXG5cdFx0XHRcdFx0XHRpZDogM1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSxcblx0XHRcdEF1ZGlvUmF3RnJhbWU6IHtcblx0XHRcdFx0ZmllbGRzOiB7XG5cdFx0XHRcdFx0aWQ6IHtcblx0XHRcdFx0XHRcdHR5cGU6IFwidWludDY0XCIsXG5cdFx0XHRcdFx0XHRpZDogMVxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0bmFtZToge1xuXHRcdFx0XHRcdFx0dHlwZTogXCJzdHJpbmdcIixcblx0XHRcdFx0XHRcdGlkOiAyXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRhdWRpbzoge1xuXHRcdFx0XHRcdFx0dHlwZTogXCJieXRlc1wiLFxuXHRcdFx0XHRcdFx0aWQ6IDNcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdHNhbXBsZVJhdGU6IHtcblx0XHRcdFx0XHRcdHR5cGU6IFwidWludDMyXCIsXG5cdFx0XHRcdFx0XHRpZDogNFxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0bnVtQ2hhbm5lbHM6IHtcblx0XHRcdFx0XHRcdHR5cGU6IFwidWludDMyXCIsXG5cdFx0XHRcdFx0XHRpZDogNVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSxcblx0XHRcdFRyYW5zY3JpcHRpb25GcmFtZToge1xuXHRcdFx0XHRmaWVsZHM6IHtcblx0XHRcdFx0XHRpZDoge1xuXHRcdFx0XHRcdFx0dHlwZTogXCJ1aW50NjRcIixcblx0XHRcdFx0XHRcdGlkOiAxXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRuYW1lOiB7XG5cdFx0XHRcdFx0XHR0eXBlOiBcInN0cmluZ1wiLFxuXHRcdFx0XHRcdFx0aWQ6IDJcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdHRleHQ6IHtcblx0XHRcdFx0XHRcdHR5cGU6IFwic3RyaW5nXCIsXG5cdFx0XHRcdFx0XHRpZDogM1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0dXNlcklkOiB7XG5cdFx0XHRcdFx0XHR0eXBlOiBcInN0cmluZ1wiLFxuXHRcdFx0XHRcdFx0aWQ6IDRcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdHRpbWVzdGFtcDoge1xuXHRcdFx0XHRcdFx0dHlwZTogXCJzdHJpbmdcIixcblx0XHRcdFx0XHRcdGlkOiA1XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9LFxuXHRcdFx0RnJhbWU6IHtcblx0XHRcdFx0b25lb2ZzOiB7XG5cdFx0XHRcdFx0ZnJhbWU6IHtcblx0XHRcdFx0XHRcdG9uZW9mOiBbXG5cdFx0XHRcdFx0XHRcdFwidGV4dFwiLFxuXHRcdFx0XHRcdFx0XHRcImF1ZGlvXCIsXG5cdFx0XHRcdFx0XHRcdFwidHJhbnNjcmlwdGlvblwiXG5cdFx0XHRcdFx0XHRdXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9LFxuXHRcdFx0XHRmaWVsZHM6IHtcblx0XHRcdFx0XHR0ZXh0OiB7XG5cdFx0XHRcdFx0XHR0eXBlOiBcIlRleHRGcmFtZVwiLFxuXHRcdFx0XHRcdFx0aWQ6IDFcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdGF1ZGlvOiB7XG5cdFx0XHRcdFx0XHR0eXBlOiBcIkF1ZGlvUmF3RnJhbWVcIixcblx0XHRcdFx0XHRcdGlkOiAyXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHR0cmFuc2NyaXB0aW9uOiB7XG5cdFx0XHRcdFx0XHR0eXBlOiBcIlRyYW5zY3JpcHRpb25GcmFtZVwiLFxuXHRcdFx0XHRcdFx0aWQ6IDNcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH1cbn07XG52YXIganNvbkRlc2NyaXB0b3IgPSB7XG5cdG9wdGlvbnM6IG9wdGlvbnMsXG5cdG5lc3RlZDogbmVzdGVkXG59O1xuXG52YXIgQXZhdGFyUXVhbGl0eTtcbihmdW5jdGlvbiAoQXZhdGFyUXVhbGl0eSkge1xuICAgIEF2YXRhclF1YWxpdHlbXCJMb3dcIl0gPSBcImxvd1wiO1xuICAgIEF2YXRhclF1YWxpdHlbXCJNZWRpdW1cIl0gPSBcIm1lZGl1bVwiO1xuICAgIEF2YXRhclF1YWxpdHlbXCJIaWdoXCJdID0gXCJoaWdoXCI7XG59KShBdmF0YXJRdWFsaXR5IHx8IChBdmF0YXJRdWFsaXR5ID0ge30pKTtcbnZhciBWb2ljZUVtb3Rpb247XG4oZnVuY3Rpb24gKFZvaWNlRW1vdGlvbikge1xuICAgIFZvaWNlRW1vdGlvbltcIkVYQ0lURURcIl0gPSBcImV4Y2l0ZWRcIjtcbiAgICBWb2ljZUVtb3Rpb25bXCJTRVJJT1VTXCJdID0gXCJzZXJpb3VzXCI7XG4gICAgVm9pY2VFbW90aW9uW1wiRlJJRU5ETFlcIl0gPSBcImZyaWVuZGx5XCI7XG4gICAgVm9pY2VFbW90aW9uW1wiU09PVEhJTkdcIl0gPSBcInNvb3RoaW5nXCI7XG4gICAgVm9pY2VFbW90aW9uW1wiQlJPQURDQVNURVJcIl0gPSBcImJyb2FkY2FzdGVyXCI7XG59KShWb2ljZUVtb3Rpb24gfHwgKFZvaWNlRW1vdGlvbiA9IHt9KSk7XG52YXIgVGFza1R5cGU7XG4oZnVuY3Rpb24gKFRhc2tUeXBlKSB7XG4gICAgVGFza1R5cGVbXCJUQUxLXCJdID0gXCJ0YWxrXCI7XG4gICAgVGFza1R5cGVbXCJSRVBFQVRcIl0gPSBcInJlcGVhdFwiO1xufSkoVGFza1R5cGUgfHwgKFRhc2tUeXBlID0ge30pKTtcbnZhciBUYXNrTW9kZTtcbihmdW5jdGlvbiAoVGFza01vZGUpIHtcbiAgICBUYXNrTW9kZVtcIlNZTkNcIl0gPSBcInN5bmNcIjtcbiAgICBUYXNrTW9kZVtcIkFTWU5DXCJdID0gXCJhc3luY1wiO1xufSkoVGFza01vZGUgfHwgKFRhc2tNb2RlID0ge30pKTtcbi8vIGV2ZW50IHR5cGVzIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG52YXIgU3RyZWFtaW5nRXZlbnRzO1xuKGZ1bmN0aW9uIChTdHJlYW1pbmdFdmVudHMpIHtcbiAgICBTdHJlYW1pbmdFdmVudHNbXCJBVkFUQVJfU1RBUlRfVEFMS0lOR1wiXSA9IFwiYXZhdGFyX3N0YXJ0X3RhbGtpbmdcIjtcbiAgICBTdHJlYW1pbmdFdmVudHNbXCJBVkFUQVJfU1RPUF9UQUxLSU5HXCJdID0gXCJhdmF0YXJfc3RvcF90YWxraW5nXCI7XG4gICAgU3RyZWFtaW5nRXZlbnRzW1wiQVZBVEFSX1RBTEtJTkdfTUVTU0FHRVwiXSA9IFwiYXZhdGFyX3RhbGtpbmdfbWVzc2FnZVwiO1xuICAgIFN0cmVhbWluZ0V2ZW50c1tcIkFWQVRBUl9FTkRfTUVTU0FHRVwiXSA9IFwiYXZhdGFyX2VuZF9tZXNzYWdlXCI7XG4gICAgU3RyZWFtaW5nRXZlbnRzW1wiVVNFUl9UQUxLSU5HX01FU1NBR0VcIl0gPSBcInVzZXJfdGFsa2luZ19tZXNzYWdlXCI7XG4gICAgU3RyZWFtaW5nRXZlbnRzW1wiVVNFUl9FTkRfTUVTU0FHRVwiXSA9IFwidXNlcl9lbmRfbWVzc2FnZVwiO1xuICAgIFN0cmVhbWluZ0V2ZW50c1tcIlVTRVJfU1RBUlRcIl0gPSBcInVzZXJfc3RhcnRcIjtcbiAgICBTdHJlYW1pbmdFdmVudHNbXCJVU0VSX1NUT1BcIl0gPSBcInVzZXJfc3RvcFwiO1xuICAgIFN0cmVhbWluZ0V2ZW50c1tcIlVTRVJfU0lMRU5DRVwiXSA9IFwidXNlcl9zaWxlbmNlXCI7XG4gICAgU3RyZWFtaW5nRXZlbnRzW1wiU1RSRUFNX1JFQURZXCJdID0gXCJzdHJlYW1fcmVhZHlcIjtcbiAgICBTdHJlYW1pbmdFdmVudHNbXCJTVFJFQU1fRElTQ09OTkVDVEVEXCJdID0gXCJzdHJlYW1fZGlzY29ubmVjdGVkXCI7XG59KShTdHJlYW1pbmdFdmVudHMgfHwgKFN0cmVhbWluZ0V2ZW50cyA9IHt9KSk7XG52YXIgQVBJRXJyb3IgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEFQSUVycm9yLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIEFQSUVycm9yKG1lc3NhZ2UsIHN0YXR1cywgcmVzcG9uc2VUZXh0KSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIG1lc3NhZ2UpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLm5hbWUgPSAnQVBJRXJyb3InO1xuICAgICAgICBfdGhpcy5zdGF0dXMgPSBzdGF0dXM7XG4gICAgICAgIF90aGlzLnJlc3BvbnNlVGV4dCA9IHJlc3BvbnNlVGV4dDtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gQVBJRXJyb3I7XG59KEVycm9yKSk7XG52YXIgU3RyZWFtaW5nQXZhdGFyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFN0cmVhbWluZ0F2YXRhcihfYSkge1xuICAgICAgICB2YXIgdG9rZW4gPSBfYS50b2tlbiwgX2IgPSBfYS5iYXNlUGF0aCwgYmFzZVBhdGggPSBfYiA9PT0gdm9pZCAwID8gXCJodHRwczovL2FwaS5oZXlnZW4uY29tXCIgOiBfYjtcbiAgICAgICAgdGhpcy5yb29tID0gbnVsbDtcbiAgICAgICAgdGhpcy5tZWRpYVN0cmVhbSA9IG51bGw7XG4gICAgICAgIHRoaXMuZXZlbnRUYXJnZXQgPSBuZXcgRXZlbnRUYXJnZXQoKTtcbiAgICAgICAgdGhpcy5hdWRpb0NvbnRleHQgPSBudWxsO1xuICAgICAgICB0aGlzLndlYlNvY2tldCA9IG51bGw7XG4gICAgICAgIHRoaXMuc2NyaXB0UHJvY2Vzc29yID0gbnVsbDtcbiAgICAgICAgdGhpcy5tZWRpYVN0cmVhbUF1ZGlvU291cmNlID0gbnVsbDtcbiAgICAgICAgdGhpcy5tZWRpYURldmljZXNTdHJlYW0gPSBudWxsO1xuICAgICAgICB0aGlzLnNlc3Npb25JZCA9IG51bGw7XG4gICAgICAgIHRoaXMudG9rZW4gPSB0b2tlbjtcbiAgICAgICAgdGhpcy5iYXNlUGF0aCA9IGJhc2VQYXRoO1xuICAgIH1cbiAgICBTdHJlYW1pbmdBdmF0YXIucHJvdG90eXBlLmNyZWF0ZVN0YXJ0QXZhdGFyID0gZnVuY3Rpb24gKHJlcXVlc3REYXRhKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBzZXNzaW9uSW5mbywgcm9vbSwgbWVkaWFTdHJlYW07XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOiByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLm5ld1Nlc3Npb24ocmVxdWVzdERhdGEpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbkluZm8gPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlc3Npb25JZCA9IHNlc3Npb25JbmZvLnNlc3Npb25faWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxhbmd1YWdlID0gcmVxdWVzdERhdGEubGFuZ3VhZ2U7XG4gICAgICAgICAgICAgICAgICAgICAgICByb29tID0gbmV3IFJvb20oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkYXB0aXZlU3RyZWFtOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR5bmFjYXN0OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvQ2FwdHVyZURlZmF1bHRzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdXRpb246IFZpZGVvUHJlc2V0cy5oNzIwLnJlc29sdXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yb29tID0gcm9vbTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVkaWFTdHJlYW0gPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgcm9vbS5vbihSb29tRXZlbnQuRGF0YVJlY2VpdmVkLCBmdW5jdGlvbiAocm9vbU1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXZlbnRNc2cgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlU3RyaW5nID0gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKHJvb21NZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRNc2cgPSBKU09OLnBhcnNlKG1lc3NhZ2VTdHJpbmcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWV2ZW50TXNnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZW1pdChldmVudE1zZy50eXBlLCBldmVudE1zZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lZGlhU3RyZWFtID0gbmV3IE1lZGlhU3RyZWFtKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByb29tLm9uKFJvb21FdmVudC5UcmFja1N1YnNjcmliZWQsIGZ1bmN0aW9uICh0cmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmFjay5raW5kID09PSBcInZpZGVvXCIgfHwgdHJhY2sua2luZCA9PT0gXCJhdWRpb1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lZGlhU3RyZWFtLmFkZFRyYWNrKHRyYWNrLm1lZGlhU3RyZWFtVHJhY2spO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGFzVmlkZW9UcmFjayA9IG1lZGlhU3RyZWFtLmdldFZpZGVvVHJhY2tzKCkubGVuZ3RoID4gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhhc0F1ZGlvVHJhY2sgPSBtZWRpYVN0cmVhbS5nZXRBdWRpb1RyYWNrcygpLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYXNWaWRlb1RyYWNrICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNBdWRpb1RyYWNrICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhX3RoaXMubWVkaWFTdHJlYW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLm1lZGlhU3RyZWFtID0gbWVkaWFTdHJlYW07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5lbWl0KFN0cmVhbWluZ0V2ZW50cy5TVFJFQU1fUkVBRFksIF90aGlzLm1lZGlhU3RyZWFtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcm9vbS5vbihSb29tRXZlbnQuVHJhY2tVbnN1YnNjcmliZWQsIGZ1bmN0aW9uICh0cmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZWRpYVRyYWNrID0gdHJhY2subWVkaWFTdHJlYW1UcmFjaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWVkaWFUcmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWRpYVN0cmVhbS5yZW1vdmVUcmFjayhtZWRpYVRyYWNrKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvb20ub24oUm9vbUV2ZW50LkRpc2Nvbm5lY3RlZCwgZnVuY3Rpb24gKHJlYXNvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmVtaXQoU3RyZWFtaW5nRXZlbnRzLlNUUkVBTV9ESVNDT05ORUNURUQsIHJlYXNvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLmxhYmVsID0gMjtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2EudHJ5cy5wdXNoKFsyLCA0LCAsIDVdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHJvb20ucHJlcGFyZUNvbm5lY3Rpb24oc2Vzc2lvbkluZm8udXJsLCBzZXNzaW9uSW5mby5hY2Nlc3NfdG9rZW4pXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgNV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDVdO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDU6IHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMuc3RhcnRTZXNzaW9uKCldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCByb29tLmNvbm5lY3Qoc2Vzc2lvbkluZm8udXJsLCBzZXNzaW9uSW5mby5hY2Nlc3NfdG9rZW4pXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHNlc3Npb25JbmZvXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBTdHJlYW1pbmdBdmF0YXIucHJvdG90eXBlLnN0YXJ0Vm9pY2VDaGF0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIGFyZ3VtZW50cywgdm9pZCAwLCBmdW5jdGlvbiAocmVxdWVzdERhdGEpIHtcbiAgICAgICAgICAgIHZhciBkZXZpY2VzU3RyZWFtLCBlXzE7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIF9hLCBfYiwgX2M7XG4gICAgICAgICAgICBpZiAocmVxdWVzdERhdGEgPT09IHZvaWQgMCkgeyByZXF1ZXN0RGF0YSA9IHt9OyB9XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9kKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfZC5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0RGF0YS51c2VTaWxlbmNlUHJvbXB0ID0gcmVxdWVzdERhdGEudXNlU2lsZW5jZVByb21wdCB8fCBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbmF2aWdhdG9yLm1lZGlhRGV2aWNlcyB8fCAhbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBfZC5sYWJlbCA9IDE7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9kLnRyeXMucHVzaChbMSwgNiwgLCA3XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLmxvYWRBdWRpb1Jhd0ZyYW1lKCldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICBfZC5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLmNvbm5lY3RXZWJTb2NrZXQoeyB1c2VTaWxlbmNlUHJvbXB0OiByZXF1ZXN0RGF0YS51c2VTaWxlbmNlUHJvbXB0IH0pXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Quc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hdWRpb0NvbnRleHQgPSBuZXcgd2luZG93LkF1ZGlvQ29udGV4dCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF0ZW5jeUhpbnQ6ICdpbnRlcmFjdGl2ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FtcGxlUmF0ZTogMTYwMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXVkaW86IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhbXBsZVJhdGU6IDE2MDAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbm5lbENvdW50OiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b0dhaW5Db250cm9sOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWNob0NhbmNlbGxhdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vaXNlU3VwcHJlc3Npb246IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VzU3RyZWFtID0gX2Quc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tZWRpYURldmljZXNTdHJlYW0gPSBkZXZpY2VzU3RyZWFtO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tZWRpYVN0cmVhbUF1ZGlvU291cmNlID0gKF9hID0gdGhpcy5hdWRpb0NvbnRleHQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jcmVhdGVNZWRpYVN0cmVhbVNvdXJjZShkZXZpY2VzU3RyZWFtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2NyaXB0UHJvY2Vzc29yID0gKF9iID0gdGhpcy5hdWRpb0NvbnRleHQpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5jcmVhdGVTY3JpcHRQcm9jZXNzb3IoNTEyLCAxLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVkaWFTdHJlYW1BdWRpb1NvdXJjZS5jb25uZWN0KHRoaXMuc2NyaXB0UHJvY2Vzc29yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2NyaXB0UHJvY2Vzc29yLmNvbm5lY3QoKF9jID0gdGhpcy5hdWRpb0NvbnRleHQpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5kZXN0aW5hdGlvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNjcmlwdFByb2Nlc3Nvci5vbmF1ZGlvcHJvY2VzcyA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfYSwgX2IsIF9jO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghX3RoaXMud2ViU29ja2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF1ZGlvRGF0YSA9IGV2ZW50LmlucHV0QnVmZmVyLmdldENoYW5uZWxEYXRhKDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwY21TMTZBcnJheSA9IGNvbnZlcnRGbG9hdDMyVG9TMTZQQ00oYXVkaW9EYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGNtQnl0ZUFycmF5ID0gbmV3IFVpbnQ4QXJyYXkocGNtUzE2QXJyYXkuYnVmZmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZnJhbWUgPSAoX2EgPSBfdGhpcy5hdWRpb1Jhd0ZyYW1lKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY3JlYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXVkaW86IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1ZGlvOiBBcnJheS5mcm9tKHBjbUJ5dGVBcnJheSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW1wbGVSYXRlOiAxNjAwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bUNoYW5uZWxzOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbmNvZGVkRnJhbWUgPSBuZXcgVWludDhBcnJheSgoX2IgPSBfdGhpcy5hdWRpb1Jhd0ZyYW1lKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZW5jb2RlKGZyYW1lKS5maW5pc2goKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKF9jID0gX3RoaXMud2ViU29ja2V0KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Muc2VuZChlbmNvZGVkRnJhbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRob3VnaCByb29tIGhhcyBiZWVuIGNvbm5lY3RlZCwgYnV0IHRoZSBzdHJlYW0gbWF5IG5vdCBiZSByZWFkeS5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHNsZWVwKDIwMDApXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhvdWdoIHJvb20gaGFzIGJlZW4gY29ubmVjdGVkLCBidXQgdGhlIHN0cmVhbSBtYXkgbm90IGJlIHJlYWR5LlxuICAgICAgICAgICAgICAgICAgICAgICAgX2Quc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgN107XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGVfMSA9IF9kLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZV8xKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGVfMTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OiByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS5jbG9zZVZvaWNlQ2hhdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICh0aGlzLmF1ZGlvQ29udGV4dCkge1xuICAgICAgICAgICAgICAgIHRoaXMuYXVkaW9Db250ZXh0ID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnNjcmlwdFByb2Nlc3Nvcikge1xuICAgICAgICAgICAgICAgIHRoaXMuc2NyaXB0UHJvY2Vzc29yLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNjcmlwdFByb2Nlc3NvciA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5tZWRpYVN0cmVhbUF1ZGlvU291cmNlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tZWRpYVN0cmVhbUF1ZGlvU291cmNlLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgICAgICAgICB0aGlzLm1lZGlhU3RyZWFtQXVkaW9Tb3VyY2UgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMubWVkaWFEZXZpY2VzU3RyZWFtKSB7XG4gICAgICAgICAgICAgICAgKF9iID0gKF9hID0gdGhpcy5tZWRpYURldmljZXNTdHJlYW0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5nZXRUcmFja3MoKSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmZvckVhY2goZnVuY3Rpb24gKHRyYWNrKSB7IHJldHVybiB0cmFjay5zdG9wKCk7IH0pO1xuICAgICAgICAgICAgICAgIHRoaXMubWVkaWFEZXZpY2VzU3RyZWFtID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLndlYlNvY2tldCkge1xuICAgICAgICAgICAgICAgIHRoaXMud2ViU29ja2V0LmNsb3NlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgfVxuICAgIH07XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS5uZXdTZXNzaW9uID0gZnVuY3Rpb24gKHJlcXVlc3REYXRhKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5yZXF1ZXN0KFwiL3YxL3N0cmVhbWluZy5uZXdcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXZhdGFyX25hbWU6IHJlcXVlc3REYXRhLmF2YXRhck5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBxdWFsaXR5OiByZXF1ZXN0RGF0YS5xdWFsaXR5LFxuICAgICAgICAgICAgICAgICAgICAgICAga25vd2xlZGdlX2Jhc2VfaWQ6IHJlcXVlc3REYXRhLmtub3dsZWRnZUlkLFxuICAgICAgICAgICAgICAgICAgICAgICAga25vd2xlZGdlX2Jhc2U6IHJlcXVlc3REYXRhLmtub3dsZWRnZUJhc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICB2b2ljZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZvaWNlX2lkOiAoX2EgPSByZXF1ZXN0RGF0YS52b2ljZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnZvaWNlSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmF0ZTogKF9iID0gcmVxdWVzdERhdGEudm9pY2UpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5yYXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtb3Rpb246IChfYyA9IHJlcXVlc3REYXRhLnZvaWNlKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuZW1vdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGV2ZW5sYWJzX3NldHRpbmdzOiAoX2QgPSByZXF1ZXN0RGF0YSA9PT0gbnVsbCB8fCByZXF1ZXN0RGF0YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVxdWVzdERhdGEudm9pY2UpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5lbGV2ZW5sYWJzU2V0dGluZ3MsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IHJlcXVlc3REYXRhLmxhbmd1YWdlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbjogXCJ2MlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmlkZW9fZW5jb2Rpbmc6IFwiSDI2NFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiAnc2RrJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVfaWRsZV90aW1lb3V0OiByZXF1ZXN0RGF0YS5kaXNhYmxlSWRsZVRpbWVvdXQsXG4gICAgICAgICAgICAgICAgICAgIH0pXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUuc3RhcnRTZXNzaW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMucmVxdWVzdChcIi92MS9zdHJlYW1pbmcuc3RhcnRcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbl9pZDogdGhpcy5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgICAgIH0pXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUuc3BlYWsgPSBmdW5jdGlvbiAocmVxdWVzdERhdGEpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGZyYW1lLCBlbmNvZGVkRnJhbWU7XG4gICAgICAgICAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2QpIHtcbiAgICAgICAgICAgICAgICByZXF1ZXN0RGF0YS50YXNrVHlwZSA9IHJlcXVlc3REYXRhLnRhc2tUeXBlIHx8IHJlcXVlc3REYXRhLnRhc2tfdHlwZSB8fCBUYXNrVHlwZS5UQUxLO1xuICAgICAgICAgICAgICAgIHJlcXVlc3REYXRhLnRhc2tNb2RlID0gcmVxdWVzdERhdGEudGFza01vZGUgfHwgVGFza01vZGUuQVNZTkM7XG4gICAgICAgICAgICAgICAgLy8gdHJ5IHRvIHVzZSB3ZWJzb2NrZXQgZmlyc3RcbiAgICAgICAgICAgICAgICAvLyBvbmx5IHN1cHBvcnQgdGFsayB0YXNrXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMud2ViU29ja2V0ICYmIHRoaXMuYXVkaW9SYXdGcmFtZSAmJiByZXF1ZXN0RGF0YS50YXNrX3R5cGUgPT09IFRhc2tUeXBlLlRBTEsgJiYgcmVxdWVzdERhdGEudGFza01vZGUgIT09IFRhc2tNb2RlLlNZTkMpIHtcbiAgICAgICAgICAgICAgICAgICAgZnJhbWUgPSAoX2EgPSB0aGlzLmF1ZGlvUmF3RnJhbWUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHJlcXVlc3REYXRhLnRleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZW5jb2RlZEZyYW1lID0gbmV3IFVpbnQ4QXJyYXkoKF9iID0gdGhpcy5hdWRpb1Jhd0ZyYW1lKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuZW5jb2RlKGZyYW1lKS5maW5pc2goKSk7XG4gICAgICAgICAgICAgICAgICAgIChfYyA9IHRoaXMud2ViU29ja2V0KSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Muc2VuZChlbmNvZGVkRnJhbWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLnJlcXVlc3QoXCIvdjEvc3RyZWFtaW5nLnRhc2tcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogcmVxdWVzdERhdGEudGV4dCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25faWQ6IHRoaXMuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGFza19tb2RlOiByZXF1ZXN0RGF0YS50YXNrTW9kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfdHlwZTogcmVxdWVzdERhdGEudGFza1R5cGUsXG4gICAgICAgICAgICAgICAgICAgIH0pXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUuc3RhcnRMaXN0ZW5pbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgdGhpcy5yZXF1ZXN0KFwiL3YxL3N0cmVhbWluZy5zdGFydF9saXN0ZW5pbmdcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbl9pZDogdGhpcy5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgICAgIH0pXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUuc3RvcExpc3RlbmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLnJlcXVlc3QoXCIvdjEvc3RyZWFtaW5nLnN0b3BfbGlzdGVuaW5nXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25faWQ6IHRoaXMuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgICAgICB9KV07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBTdHJlYW1pbmdBdmF0YXIucHJvdG90eXBlLmludGVycnVwdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCB0aGlzLnJlcXVlc3QoXCIvdjEvc3RyZWFtaW5nLmludGVycnVwdFwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uX2lkOiB0aGlzLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS5zdG9wQXZhdGFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgLy8gY2xlYXIgc29tZSByZXNvdXJjZXNcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlVm9pY2VDaGF0KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHRoaXMucmVxdWVzdChcIi92MS9zdHJlYW1pbmcuc3RvcFwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uX2lkOiB0aGlzLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uIChldmVudFR5cGUsIGxpc3RlbmVyKSB7XG4gICAgICAgIHRoaXMuZXZlbnRUYXJnZXQuYWRkRXZlbnRMaXN0ZW5lcihldmVudFR5cGUsIGxpc3RlbmVyKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICBTdHJlYW1pbmdBdmF0YXIucHJvdG90eXBlLm9mZiA9IGZ1bmN0aW9uIChldmVudFR5cGUsIGxpc3RlbmVyKSB7XG4gICAgICAgIHRoaXMuZXZlbnRUYXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudFR5cGUsIGxpc3RlbmVyKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICBTdHJlYW1pbmdBdmF0YXIucHJvdG90eXBlLnJlcXVlc3QgPSBmdW5jdGlvbiAocGF0aCwgcGFyYW1zLCBjb25maWcpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHJlc3BvbnNlLCBlcnJvclRleHQsIGpzb25EYXRhLCBlcnJvcl8yO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2EudHJ5cy5wdXNoKFswLCA1LCAsIDZdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIGZldGNoKHRoaXMuZ2V0UmVxdWVzdFVybChwYXRoKSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBcIkJlYXJlciBcIi5jb25jYXQodGhpcy50b2tlbiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocGFyYW1zKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEhcmVzcG9uc2Uub2spIHJldHVybiBbMyAvKmJyZWFrKi8sIDNdO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgcmVzcG9uc2UudGV4dCgpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JUZXh0ID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFQSUVycm9yKFwiQVBJIHJlcXVlc3QgZmFpbGVkIHdpdGggc3RhdHVzIFwiLmNvbmNhdChyZXNwb25zZS5zdGF0dXMpLCByZXNwb25zZS5zdGF0dXMsIGVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMzogcmV0dXJuIFs0IC8qeWllbGQqLywgcmVzcG9uc2UuanNvbigpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgICAgICAganNvbkRhdGEgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywganNvbkRhdGEuZGF0YV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yXzIgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcl8yO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDY6IHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBTdHJlYW1pbmdBdmF0YXIucHJvdG90eXBlLmVtaXQgPSBmdW5jdGlvbiAoZXZlbnRUeXBlLCBkZXRhaWwpIHtcbiAgICAgICAgdmFyIGV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KGV2ZW50VHlwZSwgeyBkZXRhaWw6IGRldGFpbCB9KTtcbiAgICAgICAgdGhpcy5ldmVudFRhcmdldC5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUuZ2V0UmVxdWVzdFVybCA9IGZ1bmN0aW9uIChlbmRwb2ludCkge1xuICAgICAgICByZXR1cm4gXCJcIi5jb25jYXQodGhpcy5iYXNlUGF0aCkuY29uY2F0KGVuZHBvaW50KTtcbiAgICB9O1xuICAgIFN0cmVhbWluZ0F2YXRhci5wcm90b3R5cGUuY29ubmVjdFdlYlNvY2tldCA9IGZ1bmN0aW9uIChyZXF1ZXN0RGF0YSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgd2Vic29ja2V0VXJsO1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICB3ZWJzb2NrZXRVcmwgPSBcIndzczovL1wiLmNvbmNhdChuZXcgVVJMKHRoaXMuYmFzZVBhdGgpLmhvc3RuYW1lLCBcIi92MS93cy9zdHJlYW1pbmcuY2hhdD9zZXNzaW9uX2lkPVwiKS5jb25jYXQodGhpcy5zZXNzaW9uSWQsIFwiJnNlc3Npb25fdG9rZW49XCIpLmNvbmNhdCh0aGlzLnRva2VuLCBcIiZzaWxlbmNlX3Jlc3BvbnNlPVwiKS5jb25jYXQocmVxdWVzdERhdGEudXNlU2lsZW5jZVByb21wdCk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubGFuZ3VhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgd2Vic29ja2V0VXJsICs9IFwiJnN0dF9sYW5ndWFnZT1cIi5jb25jYXQodGhpcy5sYW5ndWFnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMud2ViU29ja2V0ID0gbmV3IFdlYlNvY2tldCh3ZWJzb2NrZXRVcmwpO1xuICAgICAgICAgICAgICAgIHRoaXMud2ViU29ja2V0LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGV2ZW50RGF0YSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudERhdGEgPSBKU09OLnBhcnNlKGV2ZW50LmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmVtaXQoZXZlbnREYXRhLmV2ZW50X3R5cGUsIGV2ZW50RGF0YSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy53ZWJTb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcignY2xvc2UnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMud2ViU29ja2V0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qLywgbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgICAgICAgICAgICAgIChfYSA9IF90aGlzLndlYlNvY2tldCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMud2ViU29ja2V0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAoX2IgPSBfdGhpcy53ZWJTb2NrZXQpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5hZGRFdmVudExpc3RlbmVyKCdvcGVuJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSldO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgU3RyZWFtaW5nQXZhdGFyLnByb3RvdHlwZS5sb2FkQXVkaW9SYXdGcmFtZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHJvb3Q7XG4gICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmF1ZGlvUmF3RnJhbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcm9vdCA9IHByb3RvYnVmLlJvb3QuZnJvbUpTT04oanNvbkRlc2NyaXB0b3IpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmF1ZGlvUmF3RnJhbWUgPSByb290ID09PSBudWxsIHx8IHJvb3QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJvb3QubG9va3VwVHlwZSgncGlwZWNhdC5GcmFtZScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICByZXR1cm4gU3RyZWFtaW5nQXZhdGFyO1xufSgpKTtcblxuZXhwb3J0IHsgQXZhdGFyUXVhbGl0eSwgU3RyZWFtaW5nRXZlbnRzLCBUYXNrTW9kZSwgVGFza1R5cGUsIFZvaWNlRW1vdGlvbiwgU3RyZWFtaW5nQXZhdGFyIGFzIGRlZmF1bHQgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@heygen/streaming-avatar/lib/index.esm.js\n");

/***/ })

};
;